{% extends 'baseAdmin.html.twig' %}


  {% block header %}
    <div class="container-fluid position-relative d-flex p-0">
        <!-- Spinner Start -->
        <div id="spinner" class="show bg-dark position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->


        <!-- Sidebar Start -->
        <div class="sidebar pe-4 pb-3">
            <nav class="navbar bg-secondary navbar-dark">
                <a href="index.html" class="navbar-brand mx-4 mb-3">
                    <h3 class="text-primary"><i class="fa fa-user-edit me-2"></i>TFANNEN Dashbord</h3>
                </a>
                <div class="d-flex align-items-center ms-4 mb-4">
                    <div class="position-relative">
                        <img class="rounded-circle" src="{{ asset('assetsAdmin/img/haythem.png')}}" alt="" style="width: 60px; height: 60px;">
                        <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
                    </div>
                    <div class="ms-3">
                        <h6 class="mb-0">Haythem Raggad</h6>
                        <span>Admin</span>
                    </div>
                </div>
                <div class="navbar-nav w-100">
                    <a href="index.html" class="nav-item nav-link active"><i class="fa fa-tachometer-alt me-2"></i>Dashboard</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-laptop me-2"></i>Users</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="button.html" class="dropdown-item">Users</a>
                            <a href="typography.html" class="dropdown-item">Typography</a>
                            <a href="element.html" class="dropdown-item">Other Elements</a>
                        </div>
                    </div>
                     <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-th me-2"></i>Products And Ratings</a>
                        <div class="dropdown-menu bg-transparent border-0">

                            <a href="typography.html" class="dropdown-item">FeedBacks</a>
                        </div>
                    </div>
                     <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-keyboard me-2"></i>FeedBacks</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="button.html" class="dropdown-item">user's FeedBacks</a>
                            <a href="typography.html" class="dropdown-item">Answers</a>
                        </div>
                    </div>
                     <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-table me-2"></i>Comp√©titions</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="button.html" class="dropdown-item">Exemple 1</a>
                            <a href="typography.html" class="dropdown-item">Exemple 2</a>
                        </div>
                    </div>
                     <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-chart-bar me-2"></i>Promotions</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="button.html" class="dropdown-item">Exemple 1</a>
                            <a href="typography.html" class="dropdown-item">Exemple 2</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="far fa-file-alt me-2"></i>Commandes</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="{{ path('app_commande_dash') }}" class="dropdown-item">Liste de Commandes</a>
                            <a href="{{ path('app_livraison_index') }}" class="dropdown-item">Livraisons</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <!-- Sidebar End -->


        <!-- Content Start -->
        <div class="content">
            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0">
                <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
                    <h2 class="text-primary mb-0"><i class="fa fa-user-edit"></i></h2>
                </a>
                <a href="#" class="sidebar-toggler flex-shrink-0">
                    <i class="fa fa-bars"></i>
                </a>
                 <form id="searchForm" action="{{ path('search_b') }}" method="get">
    <div class="input-group">
        <input type="search" class="form-control bg-dark border-0" name="q" id="searchInput" placeholder="Search">
        <button type="submit" class="btn btn-outline-secondary" id="button-addon2">
            <i class="fa-solid fa-search"></i>
        </button>
    </div>
</form>

<!-- Add an empty div to display search results -->


                <div class="navbar-nav align-items-center ms-auto">
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-envelope me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Message</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="{{ asset('assetsAdmin/img/haythem.png')}}" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="{{ asset('assetsAdmin/img/haythem.png')}}" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="{{ asset('assetsAdmin/img/haythem.png')}}" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all message</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Notificatin</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Profile updated</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">New user added</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Password changed</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all notifications</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <img class="rounded-circle me-lg-2" src="{{ asset('assetsAdmin/img/haythem.png')}}" alt="" style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex">Admin Name</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">My Profile</a>
                            <a href="#" class="dropdown-item">Settings</a>
                            <a href="#" class="dropdown-item">Log Out</a>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Navbar End -->

            {% endblock %}
 {% block body %}

 
     <h1>Commande index</h1>
    <div class="container-fluid pt-4 px-4">
<div class="bg-secondary rounded-top p-4">
    <table class="table" id="commandesTable">
    <div class="bg-secondary rounded-top p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{{ path('export_commandes')}}" class="btn  btn-primary">
            <i class="fas fa-file-excel"></i> Exporter vers Excel
        </a>
        <a href="{{ path('commandes_b') }}" class="btn btn-primary">
            <i class="fas fa-sort-amount-up"></i> Tri par prix
        </a>
    </div>

    <!-- Rest of your content... -->
</div>
  
        <thead>
            <tr>
                <th><h3>Id</h3></th>
                <th><h3>Adresse</h3></th>
                <th><h3>Num_tel</h3></th>
                <th><h3>Prix</h3></th>
                <th><h3>Produits</h3></th>
                <th><h3>actions</h3></th>
            </tr>
        </thead>
        <tbody>
        {% for commande in commandes %}
        
            <tr>
                <td><h6>{{ commande.id }}</h6></td>
                <td><h6>{{ commande.adresse }}</h6></td>
                <td><h6>{{ commande.numTel }}</h6></td>
                <td><h6>{{ commande.prix }}</h6></td>
                <td><h6>{{ commande.produits }}</h6></td>
<td>
    {# Add the QR code button here #}
    {% set jsonData = {
        'id': commande.id,
        'adresse': commande.adresse
    } | json_encode %}
    <a href="{{ path('app_QrCode', {'id': commande.id}) }}" type="button" class="btn btn-primary" data-toggle="modal" data-target="#qrCodeModal{{ commande.id }}">
        QR Code
    </a>

    <!-- Modal for QR Code -->
    <div class="modal fade" id="qrCodeModal{{ commande.id }}" tabindex="-1" role="dialog" aria-labelledby="qrCodeModalLabel{{ commande.id }}" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="qrCodeModalLabel{{ commande.id }}">QR Code for Commande {{ commande.id }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Display the QR code image -->
                    <img src="{{ path('app_QrCode', {'id': commande.id}) }}" alt="QR Code for Commande {{ commande.id }}" width="300" height="300">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</td>



                <td>
                    <a href="{{ path('app_commande_delete_b', {'id': commande.id}) }}" class="btn btn-lg btn-primary btn-lg-square" style="width: 120px;height: 30px;">supprimer</a>
                    <a href="{{ path('app_livraison_new', {'id': commande.id}) }}" class="btn btn-lg btn-primary btn-lg-square" style="width: 100px;height: 30px;">livrer</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

</div>
</div> 
<script>
    // Add AJAX script for dynamic search
    document.addEventListener("DOMContentLoaded", function() {
        // Your code here
        $('#searchInput').on('input', function() {
            // Get the search string
            var searchString = $(this).val();
            console.log(searchString)
            
            // Send AJAX request with the search string
            $.ajax({
                type: 'GET',
                url: '{{ path('app_commande_dash') }}',
                data: { search: searchString }, // Include the search string in the data
                success: function(response) {
                    // Update table content with filtered/sorted data
                    updateTable(response.commandes);
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });
});

function updateTable(commandes) {
    var tableBody = $('#commandesTable tbody');
    tableBody.empty(); // Clear existing table rows

    // Add new rows based on filtered/sorted commandes
    commandes.forEach(function(commande) {
        var row = '<tr>' +
            '<td><h6>' + commande.id + '</h6></td>' +
            '<td><h6>' + commande.adresse + '</h6></td>' +
            '<td><h6>' + commande.numTel + '</h6></td>' +
            '<td><h6>' + commande.prix + '</h6></td>' +
            '<td><h6>' + commande.produits + '</h6></td>' +
                   '<td>' +
        '<a href="{{ path("app_QrCode", {"id": 'COMMANDE_ID'}) }}" type="button" class="btn btn-primary" data-toggle="modal" data-target="#qrCodeModal{{ 'COMMANDE_ID' }}">QR Code</a>' +
        '<div class="modal fade" id="qrCodeModal{{ 'COMMANDE_ID' }}" tabindex="-1" role="dialog" aria-labelledby="qrCodeModalLabel{{ 'COMMANDE_ID' }}" aria-hidden="true">' +
        '<div class="modal-dialog" role="document">' +
        '<div class="modal-content">' +
        '<div class="modal-header">' +
        '<h5 class="modal-title" id="qrCodeModalLabel{{ 'COMMANDE_ID' }}">QR Code for Commande {{ 'COMMANDE_ID' }}</h5>' +
        '<button type="button" class="close" data-dismiss="modal" aria-label="Close">' +
        '<span aria-hidden="true">&times;</span>' +
        '</button>' +
        '</div>' +
        '<div class="modal-body">' +
        '<img src="{{ path("app_QrCode", {"id": 'COMMANDE_ID'}) }}" alt="QR Code for Commande {{ 'COMMANDE_ID' }}" width="300" height="300">' +
        '</div>' +
        '<div class="modal-footer">' +
        '<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</td>' +
        '<td>' +
        '<a href="{{ path("app_commande_delete_b", {"id": 'COMMANDE_ID'}) }}" class="btn btn-lg btn-primary btn-lg-square" style="width: 120px;height: 30px;">supprimer</a>' +
        '<a href="{{ path("app_livraison_new", {"id": 'COMMANDE_ID'}) }}" class="btn btn-lg btn-primary btn-lg-square" style="width: 100px;height: 30px;">livrer</a>' +
        '</td>' +
            '</tr>';
       row = row.replace(/COMMANDE_ID/g, commande.id);

        tableBody.append(row);
    });
}
</script>
  {% endblock %}
